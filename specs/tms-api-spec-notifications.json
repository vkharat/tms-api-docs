{
  "components": {
    "schemas": {
      "Notification": {
        "allOf": [
          {
            "$ref": "./tms-api-spec-common.json#/components/schemas/BaseEntity"
          },
          {
            "type": "object",
            "required": ["priority", "content"],
            "description": "Notification message structure",
            "properties": {
              "type": {
                "type": "string",
                "enum": [
                  "SHIPMENT_UPDATE",
                  "DOCUMENT_READY",
                  "EXCEPTION_ALERT",
                  "APPROVAL_REQUEST",
                  "SYSTEM_ALERT",
                  "PAYMENT_REMINDER",
                  "COMPLIANCE_ALERT"
                ],
                "description": "Type of notification"
              },
              "priority": {
                "type": "string",
                "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"],
                "description": "Notification priority"
              },
              "content": {
                "$ref": "#/components/schemas/NotificationContent"
              },
              "recipients": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/NotificationRecipient"
                }
              },
              "channels": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/NotificationChannel"
                }
              },
              "tracking": {
                "$ref": "#/components/schemas/NotificationTracking"
              }
            }
          }
        ]
      },
      "NotificationContent": {
        "type": "object",
        "required": ["subject", "body"],
        "description": "Content of the notification",
        "properties": {
          "subject": {
            "type": "string",
            "description": "Notification subject"
          },
          "body": {
            "type": "string",
            "description": "Notification body"
          },
          "template": {
            "type": "string",
            "description": "Template identifier"
          },
          "variables": {
            "type": "object",
            "additionalProperties": true,
            "description": "Template variables"
          },
          "attachments": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/NotificationAttachment"
            }
          }
        }
      },
      "NotificationAttachment": {
        "type": "object",
        "required": ["name", "type", "content"],
        "description": "Attachment for notification",
        "properties": {
          "name": {
            "type": "string",
            "description": "Attachment name"
          },
          "type": {
            "type": "string",
            "enum": ["PDF", "IMAGE", "EXCEL", "WORD", "OTHER"],
            "description": "Attachment type"
          },
          "content": {
            "type": "string",
            "format": "uri",
            "description": "Content URI"
          },
          "size": {
            "type": "integer",
            "minimum": 0,
            "description": "Size in bytes"
          }
        }
      },
      "NotificationRecipient": {
        "type": "object",
        "required": ["type", "address"],
        "description": "Notification recipient",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["USER", "GROUP", "ROLE", "EMAIL", "PHONE"],
            "description": "Recipient type"
          },
          "address": {
            "type": "string",
            "description": "Recipient address"
          },
          "preferences": {
            "$ref": "#/components/schemas/RecipientPreferences"
          }
        }
      },
      "RecipientPreferences": {
        "type": "object",
        "description": "Recipient notification preferences",
        "properties": {
          "language": {
            "type": "string",
            "pattern": "^[a-z]{2}-[A-Z]{2}$",
            "description": "Preferred language"
          },
          "timezone": {
            "type": "string",
            "description": "Preferred timezone"
          },
          "channels": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["EMAIL", "SMS", "PUSH", "IN_APP"]
            },
            "description": "Preferred channels"
          }
        }
      },
      "NotificationChannel": {
        "type": "object",
        "required": ["type", "config"],
        "description": "Notification delivery channel",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["EMAIL", "SMS", "PUSH", "IN_APP"],
            "description": "Channel type"
          },
          "config": {
            "type": "object",
            "additionalProperties": true,
            "description": "Channel configuration"
          },
          "priority": {
            "type": "integer",
            "minimum": 1,
            "description": "Channel priority"
          }
        }
      },
      "NotificationTracking": {
        "type": "object",
        "description": "Notification delivery tracking",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["PENDING", "SENT", "DELIVERED", "FAILED", "READ"],
            "description": "Delivery status"
          },
          "attempts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/DeliveryAttempt"
            }
          },
          "readAt": {
            "type": "string",
            "format": "date-time",
            "description": "When notification was read"
          }
        }
      },
      "DeliveryAttempt": {
        "type": "object",
        "required": ["timestamp", "status"],
        "description": "Notification delivery attempt",
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "Attempt timestamp"
          },
          "status": {
            "type": "string",
            "enum": ["SUCCESS", "FAILURE"],
            "description": "Attempt status"
          },
          "channel": {
            "type": "string",
            "description": "Delivery channel used"
          },
          "error": {
            "type": "string",
            "description": "Error message if failed"
          }
        }
      },
      "NotificationMetadata": {
        "type": "object",
        "description": "Additional notification metadata",
        "properties": {
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time",
            "description": "Expiration timestamp"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Notification tags"
          },
          "source": {
            "type": "string",
            "description": "Notification source"
          }
        }
      }
    }
  }
}