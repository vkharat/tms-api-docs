{
  "openapi": "3.0.3",
  "info": {
    "title": "TMS API Billing",
    "version": "1.0.0"
  },
  "paths": {
    "/invoices": {
      "get": {
        "summary": "List all invoices",
        "operationId": "listInvoices",
        "tags": ["Billing Services"],
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          { "$ref": "./tms-api-spec-common.json#/components/parameters/pageSize" },
          { "$ref": "./tms-api-spec-common.json#/components/parameters/pageNumber" },
          {
            "name": "status",
            "in": "query",
            "description": "Filter by invoice status",
            "schema": {
              "type": "string",
              "enum": ["DRAFT", "ISSUED", "PAID", "OVERDUE", "CANCELLED"]
            }
          },
          {
            "name": "dateFrom",
            "in": "query",
            "description": "Filter by issue date (from)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "dateTo",
            "in": "query",
            "description": "Filter by issue date (to)",
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of invoices",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Invoice"
                      }
                    },
                    "pagination": {
                      "type": "object",
                      "properties": {
                        "totalItems": { "type": "integer" },
                        "totalPages": { "type": "integer" },
                        "currentPage": { "type": "integer" }
                      }
                    }
                  }
                },
                "example": {
                  "data": [
                    {
                      "invoiceId": "INV-2024-001",
                      "status": "ISSUED",
                      "issueDate": "2024-01-15",
                      "dueDate": "2024-02-14",
                      "customer": {
                        "id": "CUST-001",
                        "name": "Global Trading Co",
                        "taxId": "123456789"
                      },
                      "items": [
                        {
                          "description": "Ocean Freight",
                          "quantity": 1,
                          "unitPrice": {
                            "value": 2500,
                            "currency": "USD"
                          },
                          "amount": {
                            "value": 2500,
                            "currency": "USD"
                          }
                        },
                        {
                          "description": "BAF Surcharge",
                          "quantity": 1,
                          "unitPrice": {
                            "value": 250,
                            "currency": "USD"
                          },
                          "amount": {
                            "value": 250,
                            "currency": "USD"
                          }
                        }
                      ],
                      "totalAmount": {
                        "value": 2750,
                        "currency": "USD"
                      },
                      "paymentTerms": "Net 30"
                    }
                  ],
                  "pagination": {
                    "totalItems": 45,
                    "totalPages": 3,
                    "currentPage": 1
                  }
                }
              }
            }
          },
          "400": { "$ref": "./tms-api-spec-common.json#/components/responses/BadRequest" },
          "401": { "$ref": "./tms-api-spec-common.json#/components/responses/Unauthorized" }
        }
      },
      "post": {
        "summary": "Create new invoice",
        "operationId": "createInvoice",
        "tags": ["Billing Services"],
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Invoice"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Invoice created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Invoice"
                }
              }
            }
          },
          "400": { "$ref": "./tms-api-spec-common.json#/components/responses/BadRequest" },
          "401": { "$ref": "./tms-api-spec-common.json#/components/responses/Unauthorized" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Invoice": {
        "type": "object",
        "required": ["invoiceId", "status", "issueDate", "customer", "items", "totalAmount"],
        "properties": {
          "invoiceId": {
            "type": "string",
            "description": "Unique invoice identifier"
          },
          "status": {
            "type": "string",
            "enum": ["DRAFT", "ISSUED", "PAID", "OVERDUE", "CANCELLED"],
            "description": "Invoice status"
          },
          "issueDate": {
            "type": "string",
            "format": "date",
            "description": "Date when invoice was issued"
          },
          "dueDate": {
            "type": "string",
            "format": "date",
            "description": "Payment due date"
          },
          "customer": {
            "$ref": "#/components/schemas/Customer"
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InvoiceItem"
            },
            "description": "Invoice line items"
          },
          "totalAmount": {
            "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
          },
          "paymentTerms": {
            "type": "string",
            "description": "Payment terms"
          }
        }
      },
      "Customer": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Customer identifier"
          },
          "name": {
            "type": "string",
            "description": "Customer name"
          },
          "taxId": {
            "type": "string",
            "description": "Tax identification number"
          }
        }
      },
      "InvoiceItem": {
        "type": "object",
        "required": ["description", "quantity", "unitPrice", "amount"],
        "properties": {
          "description": {
            "type": "string",
            "description": "Item description"
          },
          "quantity": {
            "type": "number",
            "format": "double",
            "minimum": 0,
            "description": "Quantity"
          },
          "unitPrice": {
            "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
          },
          "amount": {
            "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
          }
        }
      },
      "BillingParty": {
        "type": "object",
        "required": ["partyId", "billingDetails"],
        "properties": {
          "partyId": {
            "type": "string"
          },
          "billingDetails": {
            "$ref": "#/components/schemas/BillingDetails"
          }
        }
      },
      "BillingDetails": {
        "allOf": [
          {
            "$ref": "./tms-api-spec-common.json#/components/schemas/BaseEntity"
          },
          {
            "type": "object",
            "required": ["billingParty", "amount"],
            "description": "Billing information",
            "properties": {
              "billingParty": {
                "$ref": "./tms-api-spec-common.json#/components/schemas/Party"
              },
              "amount": {
                "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
              },
              "dueDate": {
                "type": "string",
                "format": "date",
                "description": "Payment due date"
              },
              "paymentTerms": {
                "type": "string",
                "description": "Payment terms description"
              },
              "invoiceNumber": {
                "type": "string",
                "description": "Invoice reference number"
              },
              "lineItems": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/BillingLineItem"
                }
              },
              "taxes": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/TaxDetail"
                }
              }
            }
          }
        ]
      },
      "BillingLineItem": {
        "type": "object",
        "required": ["description", "amount"],
        "description": "Individual billing line item",
        "properties": {
          "description": {
            "type": "string",
            "description": "Line item description"
          },
          "amount": {
            "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
          },
          "quantity": {
            "type": "number",
            "minimum": 0,
            "description": "Quantity of items"
          },
          "unitPrice": {
            "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
          },
          "serviceCode": {
            "type": "string",
            "description": "Service code reference"
          }
        }
      },
      "TaxDetail": {
        "type": "object",
        "required": ["type", "rate", "amount"],
        "description": "Tax information",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["VAT", "GST", "SALES_TAX", "OTHER"],
            "description": "Type of tax"
          },
          "rate": {
            "type": "number",
            "minimum": 0,
            "maximum": 100,
            "description": "Tax rate percentage"
          },
          "amount": {
            "$ref": "./tms-api-spec-common.json#/components/schemas/MonetaryAmount"
          },
          "taxNumber": {
            "type": "string",
            "description": "Tax registration number"
          }
        }
      },
      "InvoicingPreferences": {
        "type": "object",
        "description": "Invoicing preferences",
        "properties": {
          "frequency": {
            "type": "string",
            "enum": ["PER_SHIPMENT", "WEEKLY", "MONTHLY"],
            "description": "Invoicing frequency"
          },
          "format": {
            "type": "string",
            "enum": ["PDF", "EDI", "API"],
            "description": "Invoice format"
          },
          "currency": {
            "type": "string",
            "pattern": "^[A-Z]{3}$",
            "description": "Preferred billing currency"
          }
        }
      },
      "PaymentMethod": {
        "type": "object",
        "description": "Payment method details",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["CREDIT_CARD", "BANK_TRANSFER", "LETTER_OF_CREDIT"],
            "description": "Payment method type"
          },
          "details": {
            "type": "object",
            "additionalProperties": true,
            "description": "Payment method specific details"
          }
        }
      },
      "TaxInformation": {
        "type": "object",
        "description": "Tax information",
        "properties": {
          "taxId": {
            "type": "string",
            "description": "Tax identification number"
          },
          "taxExempt": {
            "type": "boolean",
            "description": "Whether the entity is tax exempt"
          },
          "taxCodes": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Applicable tax codes"
          }
        }
      },
      "Party": {
        "type": "object",
        "required": ["partyId", "name"],
        "description": "Party information",
        "properties": {
          "partyId": {
            "type": "string",
            "description": "Unique identifier for the party"
          },
          "name": {
            "type": "string",
            "description": "Party name"
          },
          "type": {
            "type": "string",
            "enum": ["SHIPPER", "CONSIGNEE", "FREIGHT_FORWARDER", "CUSTOMS_BROKER"],
            "description": "Type of party"
          },
          "address": {
            "$ref": "#/components/schemas/Address"
          },
          "contact": {
            "$ref": "#/components/schemas/Contact"
          }
        }
      },
      "Address": {
        "type": "object",
        "required": ["country"],
        "description": "Physical address",
        "properties": {
          "street": {
            "type": "string",
            "description": "Street address"
          },
          "city": {
            "type": "string",
            "description": "City name"
          },
          "state": {
            "type": "string",
            "description": "State or province"
          },
          "postalCode": {
            "type": "string",
            "description": "Postal or ZIP code"
          },
          "country": {
            "type": "string",
            "pattern": "^[A-Z]{2}$",
            "description": "ISO country code"
          }
        }
      },
      "Contact": {
        "type": "object",
        "description": "Contact information",
        "properties": {
          "name": {
            "type": "string",
            "description": "Contact name"
          },
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email address"
          },
          "phone": {
            "type": "string",
            "pattern": "^\\+?[1-9]\\d{1,14}$",
            "description": "Phone number"
          }
        }
      },
      "InvoiceCharge": {
        "type": "object",
        "required": ["chargeType", "amount"],
        "properties": {
          "chargeType": {
            "type": "string",
            "enum": ["FREIGHT", "FUEL_SURCHARGE", "HANDLING"]
          },
          "amount": {
            "$ref": "#/components/schemas/MonetaryAmount"
          }
        }
      },
      "MonetaryAmount": {
        "type": "object",
        "required": ["value", "currency"],
        "properties": {
          "value": {
            "type": "number"
          },
          "currency": {
            "type": "string",
            "enum": ["USD", "EUR", "GBP"]
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Quote Management",
      "description": "Operations for creating and managing shipping quotes"
    },
    {
      "name": "Location Services",
      "description": "Operations for location validation and geocoding"
    },
    {
      "name": "Cargo Management",
      "description": "Operations for cargo specification and validation"
    },
    {
      "name": "Rate Services",
      "description": "Operations for rate calculation and pricing"
    },
    {
      "name": "Schedule Services",
      "description": "Operations for transit times and scheduling"
    },
    {
      "name": "Billing Services",
      "description": "Operations for billing and invoicing"
    }
  ]
}